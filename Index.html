<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FleetFlow - Gesti√≥n de Flotas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #0ea5e9;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1e293b;
            --light: #f8fafc;
            --gray: #94a3b8;
            --border: #e2e8f0;
            --sidebar-width: 250px;
            --header-height: 60px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f1f5f9;
            color: var(--dark);
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: white;
            height: 100vh;
            position: fixed;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.05);
            z-index: 100;
            transition: all 0.3s ease;
        }
        
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            background: var(--primary);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .logo-text {
            font-size: 20px;
            font-weight: 700;
            color: var(--dark);
        }
        
        .logo-text span {
            color: var(--primary);
        }
        
        .nav-links {
            padding: 20px 0;
        }
        
        .nav-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--dark);
            text-decoration: none;
        }
        
        .nav-item:hover {
            background: #f1f5f9;
        }
        
        .nav-item.active {
            background: #dbeafe;
            color: var(--primary);
            border-left: 4px solid var(--primary);
        }
        
        .nav-item i {
            width: 20px;
            text-align: center;
        }
        
        .sidebar-footer {
            position: absolute;
            bottom: 0;
            width: 100%;
            padding: 15px 20px;
            border-top: 1px solid var(--border);
            font-size: 14px;
            color: var(--gray);
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            min-height: 100vh;
        }
        
        /* Header */
        .header {
            height: var(--header-height);
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            position: sticky;
            top: 0;
            z-index: 90;
        }
        
        .header-title h1 {
            font-size: 22px;
            font-weight: 600;
        }
        
        .header-title p {
            font-size: 14px;
            color: var(--gray);
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .search-box {
            position: relative;
        }
        
        .search-box input {
            padding: 8px 15px 8px 35px;
            border-radius: 20px;
            border: 1px solid var(--border);
            font-size: 14px;
            width: 250px;
        }
        
        .search-box i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }
        
        .notification-btn, .user-btn {
            position: relative;
            background: none;
            border: none;
            font-size: 20px;
            color: var(--dark);
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .notification-btn:hover, .user-btn:hover {
            background: #f1f5f9;
        }
        
        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            font-size: 10px;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
        }
        
        .user-info {
            text-align: left;
        }
        
        .user-name {
            font-size: 14px;
            font-weight: 500;
        }
        
        .user-role {
            font-size: 12px;
            color: var(--gray);
        }
        
        /* Content */
        .content {
            padding: 30px;
        }
        
        .page-title {
            margin-bottom: 25px;
        }
        
        .page-title h2 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .page-title p {
            color: var(--gray);
            font-size: 15px;
        }
        
        /* Stats Cards */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .stat-icon.vehicles {
            background: #dbeafe;
            color: var(--primary);
        }
        
        .stat-icon.drivers {
            background: #dcfce7;
            color: var(--success);
        }
        
        .stat-icon.trips {
            background: #fef3c7;
            color: var(--warning);
        }
        
        .stat-icon.maintenance {
            background: #fee2e2;
            color: var(--danger);
        }
        
        .stat-info h3 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .stat-info p {
            color: var(--gray);
            font-size: 14px;
        }
        
        /* Charts */
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .chart-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .chart-header h3 {
            font-size: 18px;
            font-weight: 600;
        }
        
        .chart-actions button {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 14px;
        }
        
        .chart-container {
            height: 300px;
            position: relative;
        }
        
        /* Tables */
        .table-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }
        
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .table-header h3 {
            font-size: 18px;
            font-weight: 600;
        }
        
        .table-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--dark);
        }
        
        .btn-outline:hover {
            background: #f1f5f9;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        th {
            font-weight: 600;
            color: var(--gray);
            font-size: 14px;
        }
        
        tbody tr:hover {
            background: #f8fafc;
        }
        
        .status-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-badge.scheduled {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .status-badge.in-progress {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-badge.completed {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-badge.pending {
            background: #ffe4e6;
            color: #991b1b;
        }
        
        .status-badge.high {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .status-badge.medium {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-badge.low {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .action-btn {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 16px;
            margin: 0 5px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .action-btn:hover {
            background: #f1f5f9;
            color: var(--dark);
        }
        
        /* Forms */
        .form-container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            max-width: 800px;
            margin: 0 auto;
        }
        
        .form-header {
            margin-bottom: 25px;
        }
        
        .form-header h2 {
            font-size: 22px;
            font-weight: 600;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 15px;
            transition: border 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .form-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
        }
        
        /* Map */
        .map-container {
            height: 500px;
            background: #e2e8f0;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .map-overlay {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            width: 300px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 10;
        }
        
        .map-overlay h3 {
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .vehicle-marker {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transform: translate(-50%, -50%);
            cursor: pointer;
            transition: transform 0.2s;
            z-index: 5;
        }
        
        .vehicle-marker:hover {
            transform: translate(-50%, -50%) scale(1.2);
            z-index: 10;
        }
        
        .vehicle-marker.available {
            background: var(--success);
        }
        
        .vehicle-marker.in-transit {
            background: var(--primary);
        }
        
        .vehicle-marker.maintenance {
            background: var(--warning);
        }
        
        .vehicle-marker.out-of-service {
            background: var(--danger);
        }
        
        .vehicle-marker.incident {
            background: var(--danger);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        
        /* Notifications */
        .notification-dropdown {
            position: absolute;
            top: 50px;
            right: 0;
            width: 350px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: none;
        }
        
        .notification-dropdown.show {
            display: block;
        }
        
        .notification-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .notification-header h4 {
            font-size: 16px;
            font-weight: 600;
        }
        
        .notification-list {
            max-height: 350px;
            overflow-y: auto;
        }
        
        .notification-item {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            gap: 15px;
        }
        
        .notification-item:last-child {
            border-bottom: none;
        }
        
        .notification-item.unread {
            background: #f0f9ff;
        }
        
        .notification-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .notification-icon.vehicles {
            background: #dbeafe;
            color: var(--primary);
        }
        
        .notification-icon.trips {
            background: #fef3c7;
            color: var(--warning);
        }
        
        .notification-icon.maintenance {
            background: #fee2e2;
            color: var(--danger);
        }
        
        .notification-icon.incident {
            background: #fee2e2;
            color: var(--danger);
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-content h5 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 3px;
        }
        
        .notification-content p {
            font-size: 13px;
            color: var(--gray);
            margin-bottom: 5px;
        }
        
        .notification-time {
            font-size: 11px;
            color: var(--gray);
        }
        
        .notification-footer {
            padding: 12px 20px;
            text-align: center;
            border-top: 1px solid var(--border);
        }
        
        .notification-footer a {
            color: var(--primary);
            text-decoration: none;
            font-size: 14px;
        }
        
        /* Maintenance Details */
        .maintenance-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .maintenance-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .maintenance-card h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .maintenance-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .maintenance-item:last-child {
            border-bottom: none;
        }
        
        .maintenance-label {
            font-weight: 500;
        }
        
        .maintenance-value {
            color: var(--gray);
        }
        
        .parts-list {
            margin-top: 15px;
        }
        
        .part-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .part-item:last-child {
            border-bottom: none;
        }
        
        .part-name {
            font-weight: 500;
        }
        
        .part-details {
            color: var(--gray);
            font-size: 14px;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 500;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
        }
        
        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            display: none;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .charts-container {
                grid-template-columns: 1fr;
            }
            
            .maintenance-details {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }
            
            .logo-text, .nav-text {
                display: none;
            }
            
            .main-content {
                margin-left: 70px;
            }
            
            .header {
                padding: 0 15px;
            }
            
            .search-box input {
                width: 150px;
            }
            
            .user-info {
                display: none;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 576px) {
            .header-actions .search-box {
                display: none;
            }
            
            .table-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .table-actions {
                width: 100%;
                justify-content: flex-end;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-truck"></i>
                </div>
                <div class="logo-text">Fleet<span>Flow</span></div>
            </div>
        </div>
        
        <div class="nav-links">
            <a href="#" class="nav-item active" data-page="dashboard">
                <i class="fas fa-home"></i>
                <span class="nav-text">Dashboard</span>
            </a>
            <a href="#" class="nav-item" data-page="vehicles">
                <i class="fas fa-truck"></i>
                <span class="nav-text">Veh√≠culos</span>
            </a>
            <a href="#" class="nav-item" data-page="maintenance">
                <i class="fas fa-tools"></i>
                <span class="nav-text">Mantenimiento</span>
            </a>
            <a href="#" class="nav-item" data-page="incidents">
                <i class="fas fa-car-crash"></i>
                <span class="nav-text">Incidentes</span>
            </a>
            <a href="#" class="nav-item" data-page="tracking">
                <i class="fas fa-map-marked-alt"></i>
                <span class="nav-text">Seguimiento GPS</span>
            </a>
            <a href="#" class="nav-item" data-page="reports">
                <i class="fas fa-chart-bar"></i>
                <span class="nav-text">Reportes</span>
            </a>
        </div>
        
        <div class="sidebar-footer">
            <p>FleetFlow v3.0</p>
            <p>Gesti√≥n de Flotas</p>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="header">
            <div class="header-title">
                <h1>Dashboard</h1>
                <p>Resumen de tu flota de veh√≠culos</p>
            </div>
            
            <div class="header-actions">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Buscar...">
                </div>
                
                <button class="notification-btn" id="notificationBtn">
                    <i class="far fa-bell"></i>
                    <span class="badge" id="notificationBadge">5</span>
                </button>
                
                <div class="notification-dropdown" id="notificationDropdown">
                    <div class="notification-header">
                        <h4>Notificaciones</h4>
                        <a href="#" id="markAllRead">Marcar todas como le√≠das</a>
                    </div>
                    <div class="notification-list" id="notificationList">
                        <!-- Notifications will be populated by JavaScript -->
                    </div>
                    <div class="notification-footer">
                        <a href="#">Ver todas las notificaciones</a>
                    </div>
                </div>
                
                <div class="user-profile">
                    <div class="user-avatar">JP</div>
                    <div class="user-info">
                        <div class="user-name">Juan P√©rez</div>
                        <div class="user-role">Administrador</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Content -->
        <div class="content">
            <!-- Dashboard Page -->
            <div id="dashboard-page" class="page active">
                <div class="page-title">
                    <h2>Dashboard</h2>
                    <p>Resumen de tu flota de veh√≠culos</p>
                </div>
                
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-icon vehicles">
                            <i class="fas fa-truck"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalVehicles">24</h3>
                            <p>Veh√≠culos</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon maintenance">
                            <i class="fas fa-tools"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="activeMaintenance">8</h3>
                            <p>Mantenimientos Activos</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon maintenance">
                            <i class="fas fa-cogs"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalParts">156</h3>
                            <p>Piezas Registradas</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon maintenance">
                            <i class="fas fa-wrench"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="repairOrders">42</h3>
                            <p>√ìrdenes de Reparaci√≥n</p>
                        </div>
                    </div>
                </div>
                
                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Mantenimientos por Mes</h3>
                            <div class="chart-actions">
                                <button id="exportMaintenanceChart"><i class="fas fa-download"></i> Exportar</button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="maintenanceChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Costos de Mantenimiento</h3>
                            <div class="chart-actions">
                                <button id="exportCostsChart"><i class="fas fa-download"></i> Exportar</button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="costsChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="table-card">
                    <div class="table-header">
                        <h3>Mantenimientos Programados</h3>
                        <div class="table-actions">
                            <button class="btn btn-outline">
                                <i class="fas fa-filter"></i> Filtrar
                            </button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Ficha</th>
                                <th>Veh√≠culo</th>
                                <th>Tipo</th>
                                <th>Descripci√≥n</th>
                                <th>Fecha Programada</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="scheduledMaintenanceTable">
                            <!-- Table rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Vehicles Page -->
            <div id="vehicles-page" class="page" style="display: none;">
                <div class="page-title">
                    <h2>Veh√≠culos</h2>
                    <p>Gestiona tu flota de veh√≠culos</p>
                </div>
                
                <div class="table-card">
                    <div class="table-header">
                        <h3>Listado de Veh√≠culos</h3>
                        <div class="table-actions">
                            <button class="btn btn-primary" id="addVehicleBtn">
                                <i class="fas fa-plus"></i> Agregar Veh√≠culo
                            </button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Ficha</th>
                                <th>Placa</th>
                                <th>Marca/Modelo</th>
                                <th>A√±o</th>
                                <th>Kilometraje</th>
                                <th>√öltimo Mantenimiento</th>
                                <th>Pr√≥ximo Cambio Aceite</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="vehiclesTable">
                            <!-- Table rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Maintenance Page -->
            <div id="maintenance-page" class="page" style="display: none;">
                <div class="page-title">
                    <h2>Mantenimiento</h2>
                    <p>Gestiona el mantenimiento de tu flota</p>
                </div>
                
                <div class="table-card">
                    <div class="table-header">
                        <h3>√ìrdenes de Mantenimiento</h3>
                        <div class="table-actions">
                            <button class="btn btn-primary" id="addMaintenanceBtn">
                                <i class="fas fa-plus"></i> Nueva Orden
                            </button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Ficha</th>
                                <th>ID</th>
                                <th>Veh√≠culo</th>
                                <th>Tipo</th>
                                <th>Descripci√≥n</th>
                                <th>Fecha Programada</th>
                                <th>Costo</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="maintenanceTable">
                            <!-- Table rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <div class="maintenance-details">
                    <div class="maintenance-card">
                        <h3>Detalles del Veh√≠culo: ABC-123</h3>
                        <div class="maintenance-item">
                            <span class="maintenance-label">Kilometraje Actual:</span>
                            <span class="maintenance-value">125,430 km</span>
                        </div>
                        <div class="maintenance-item">
                            <span class="maintenance-label">√öltimo Cambio de Aceite:</span>
                            <span class="maintenance-value">15/05/2024 (120,000 km)</span>
                        </div>
                        <div class="maintenance-item">
                            <span class="maintenance-label">Pr√≥ximo Cambio de Aceite:</span>
                            <span class="maintenance-value">15/08/2024 (135,000 km)</span>
                        </div>
                        <div class="maintenance-item">
                            <span class="maintenance-label">Kilometraje para Cambio:</span>
                            <span class="maintenance-value">15,000 km</span>
                        </div>
                    </div>
                    
                    <div class="maintenance-card">
                        <h3>Piezas Reemplazadas Recientemente</h3>
                        <div class="parts-list">
                            <div class="part-item">
                                <div>
                                    <div class="part-name">Filtro de Aceite</div>
                                    <div class="part-details">Marca: Bosch, Modelo: 12345</div>
                                </div>
                                <div class="part-details">15/05/2024</div>
                            </div>
                            <div class="part-item">
                                <div>
                                    <div class="part-name">Buj√≠as</div>
                                    <div class="part-details">Marca: NGK, Modelo: BKR6E</div>
                                </div>
                                <div class="part-details">15/05/2024</div>
                            </div>
                            <div class="part-item">
                                <div>
                                    <div class="part-name">Pastillas de Freno</div>
                                    <div class="part-details">Marca: Brembo, Modelo: P123</div>
                                </div>
                                <div class="part-details">10/04/2024</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Incidents Page -->
            <div id="incidents-page" class="page" style="display: none;">
                <div class="page-title">
                    <h2>Incidentes</h2>
                    <p>Registro de incidentes y da√±os</p>
                </div>
                
                <div class="table-card">
                    <div class="table-header">
                        <h3>Registro de Incidentes</h3>
                        <div class="table-actions">
                            <button class="btn btn-primary" id="addIncidentBtn">
                                <i class="fas fa-plus"></i> Registrar Incidente
                            </button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Ficha</th>
                                <th>ID</th>
                                <th>Veh√≠culo</th>
                                <th>Fecha</th>
                                <th>Tipo</th>
                                <th>Conductor</th>
                                <th>Gravedad</th>
                                <th>Costo</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="incidentsTable">
                            <!-- Table rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Tracking Page -->
            <div id="tracking-page" class="page" style="display: none;">
                <div class="page-title">
                    <h2>Seguimiento GPS</h2>
                    <p>Ubicaci√≥n en tiempo real de tu flota</p>
                </div>
                
                <div class="map-container" id="mapContainer">
                    <div class="map-overlay">
                        <h3>Veh√≠culos en Ruta</h3>
                        <div id="vehicleList">
                            <!-- Vehicle list will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
                
                <div class="table-card">
                    <div class="table-header">
                        <h3>Historial de Recorridos</h3>
                        <div class="table-actions">
                            <button class="btn btn-outline">
                                <i class="fas fa-filter"></i> Filtrar
                            </button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Ficha</th>
                                <th>Veh√≠culo</th>
                                <th>Fecha/Hora</th>
                                <th>Kilometraje</th>
                                <th>Ubicaci√≥n</th>
                                <th>Velocidad</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody id="trackingHistoryTable">
                            <!-- Table rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Reports Page -->
            <div id="reports-page" class="page" style="display: none;">
                <div class="page-title">
                    <h2>Reportes y Estad√≠sticas</h2>
                    <p>An√°lisis detallado de tu flota</p>
                </div>
                
                <div class="tabs">
                    <div class="tab active" data-tab="maintenance">Mantenimiento</div>
                    <div class="tab" data-tab="incidents">Incidentes</div>
                    <div class="tab" data-tab="tracking">Seguimiento</div>
                </div>
                
                <div class="tab-content" id="maintenanceReports">
                    <div class="table-card">
                        <div class="table-header">
                            <h3>Reportes de Mantenimiento</h3>
                            <div class="table-actions">
                                <select id="reportPeriod">
                                    <option value="weekly">Semanal</option>
                                    <option value="monthly" selected>Mensual</option>
                                    <option value="quarterly">Trimestral</option>
                                    <option value="semiannual">Semestral</option>
                                    <option value="annual">Anual</option>
                                </select>
                                <button class="btn btn-outline" id="generateReport">
                                    <i class="fas fa-sync"></i> Generar Reporte
                                </button>
                                <button class="btn btn-success" id="exportReport">
                                    <i class="fas fa-file-pdf"></i> Exportar PDF
                                </button>
                            </div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Ficha</th>
                                    <th>Veh√≠culo</th>
                                    <th>Mantenimientos</th>
                                    <th>Costo Total</th>
                                    <th>Piezas Utilizadas</th>
                                    <th>Kilometraje Promedio</th>
                                    <th>Eficiencia</th>
                                </tr>
                            </thead>
                            <tbody id="maintenanceReportTable">
                                <!-- Table rows will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="incidentsReports" style="display: none;">
                    <div class="table-card">
                        <div class="table-header">
                            <h3>Reportes de Incidentes</h3>
                            <div class="table-actions">
                                <select id="incidentReportPeriod">
                                    <option value="weekly">Semanal</option>
                                    <option value="monthly" selected>Mensual</option>
                                    <option value="quarterly">Trimestral</option>
                                    <option value="semiannual">Semestral</option>
                                    <option value="annual">Anual</option>
                                </select>
                                <button class="btn btn-outline" id="generateIncidentReport">
                                    <i class="fas fa-sync"></i> Generar Reporte
                                </button>
                                <button class="btn btn-success" id="exportIncidentReport">
                                    <i class="fas fa-file-pdf"></i> Exportar PDF
                                </button>
                            </div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Ficha</th>
                                    <th>Veh√≠culo</th>
                                    <th>Incidentes</th>
                                    <th>Costo Total</th>
                                    <th>Conductores Involucrados</th>
                                    <th>Tipo M√°s Com√∫n</th>
                                    <th>Gravedad Promedio</th>
                                </tr>
                            </thead>
                            <tbody id="incidentReportTable">
                                <!-- Table rows will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="trackingReports" style="display: none;">
                    <div class="table-card">
                        <div class="table-header">
                            <h3>Reportes de Seguimiento</h3>
                            <div class="table-actions">
                                <select id="trackingReportPeriod">
                                    <option value="weekly">Semanal</option>
                                    <option value="monthly" selected>Mensual</option>
                                    <option value="quarterly">Trimestral</option>
                                    <option value="semiannual">Semestral</option>
                                    <option value="annual">Anual</option>
                                </select>
                                <button class="btn btn-outline" id="generateTrackingReport">
                                    <i class="fas fa-sync"></i> Generar Reporte
                                </button>
                                <button class="btn btn-success" id="exportTrackingReport">
                                    <i class="fas fa-file-pdf"></i> Exportar PDF
                                </button>
                            </div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Ficha</th>
                                    <th>Veh√≠culo</th>
                                    <th>Kilometraje Total</th>
                                    <th>Tiempo en Ruta</th>
                                    <th>Velocidad Promedio</th>
                                    <th>Ubicaciones Clave</th>
                                </tr>
                            </thead>
                            <tbody id="trackingReportTable">
                                <!-- Table rows will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="tab-content" id="vehiclesReports" style="display: none;">
                    <div class="table-card">
                        <div class="table-header">
                            <h3>Reportes de Veh√≠culos</h3>
                            <div class="table-actions">
                                <select id="vehiclesReportPeriod">
                                    <option value="weekly">Semanal</option>
                                    <option value="monthly" selected>Mensual</option>
                                    <option value="quarterly">Trimestral</option>
                                    <option value="semiannual">Semestral</option>
                                    <option value="annual">Anual</option>
                                </select>
                                <button class="btn btn-outline" id="generateVehiclesReport">
                                    <i class="fas fa-sync"></i> Generar Reporte
                                </button>
                                <button class="btn btn-success" id="exportVehiclesReport">
                                    <i class="fas fa-file-pdf"></i> Exportar PDF
                                </button>
                            </div>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Ficha</th>
                                    <th>Veh√≠culo</th>
                                    <th>Estado Actual</th>
                                    <th>Kilometraje Total</th>
                                    <th>Mantenimientos</th>
                                    <th>Incidentes</th>
                                    <th>Costo Total</th>
                                </tr>
                            </thead>
                            <tbody id="vehiclesReportTable">
                                <!-- Table rows will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Vehicle Form Modal -->
    <div id="vehicleModal" class="modal">
        <div class="modal-content">
            <div class="form-container">
                <div class="form-header">
                    <h2 id="vehicleModalTitle">Agregar Veh√≠culo</h2>
                </div>
                <form id="vehicleForm">
                    <input type="hidden" id="vehicleId">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="vehicleFicha">N√∫mero de Ficha</label>
                            <input type="text" id="vehicleFicha" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="plate">Placa</label>
                            <input type="text" id="plate" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="brand">Marca</label>
                            <input type="text" id="brand" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="model">Modelo</label>
                            <input type="text" id="model" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="year">A√±o</label>
                            <input type="number" id="year" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="mileage">Kilometraje Actual</label>
                            <input type="number" id="mileage" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="status">Estado</label>
                            <select id="status" class="form-control" required>
                                <option value="available">Disponible</option>
                                <option value="in_transit">En Tr√°nsito</option>
                                <option value="maintenance">Mantenimiento</option>
                                <option value="out_of_service">Fuera de Servicio</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-footer">
                        <button type="button" class="btn btn-outline" id="cancelVehicleBtn">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar Veh√≠culo</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Maintenance Form Modal -->
    <div id="maintenanceModal" class="modal">
        <div class="modal-content">
            <div class="form-container">
                <div class="form-header">
                    <h2 id="maintenanceModalTitle">Nueva Orden de Mantenimiento</h2>
                </div>
                <form id="maintenanceForm">
                    <input type="hidden" id="maintenanceId">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="maintenanceFicha">N√∫mero de Ficha</label>
                            <input type="text" id="maintenanceFicha" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="maintenanceVehicle">Veh√≠culo</label>
                            <select id="maintenanceVehicle" class="form-control" required>
                                <option value="">Seleccionar veh√≠culo</option>
                                <!-- Options will be populated by JavaScript -->
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="maintenanceType">Tipo de Mantenimiento</label>
                            <select id="maintenanceType" class="form-control" required>
                                <option value="">Seleccionar tipo</option>
                                <option value="preventive">Preventivo</option>
                                <option value="corrective">Correctivo</option>
                                <option value="predictive">Predictivo</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="scheduledDate">Fecha Programada</label>
                            <input type="date" id="scheduledDate" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="maintenanceDescription">Descripci√≥n</label>
                        <textarea id="maintenanceDescription" class="form-control" rows="3" required></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="maintenanceCost">Costo Estimado ($)</label>
                            <input type="number" id="maintenanceCost" class="form-control" step="0.01" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="maintenanceParts">Piezas a Utilizar</label>
                        <select id="maintenanceParts" class="form-control" multiple>
                            <option value="oil">Aceite Motor 15W40 - Castrol</option>
                            <option value="oil_filter">Filtro de Aceite - Bosch</option>
                            <option value="brake_pads">Pastillas de Freno - Brembo</option>
                            <option value="tires">Neum√°ticos - Michelin</option>
                        </select>
                        <button type="button" class="btn btn-outline" style="margin-top: 10px;">
                            <i class="fas fa-plus"></i> Agregar Nueva Pieza
                        </button>
                    </div>
                    <div class="form-footer">
                        <button type="button" class="btn btn-outline" id="cancelMaintenanceBtn">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Crear Orden</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Incident Form Modal -->
    <div id="incidentModal" class="modal">
        <div class="modal-content">
            <div class="form-container">
                <div class="form-header">
                    <h2 id="incidentModalTitle">Registrar Incidente</h2>
                </div>
                <form id="incidentForm">
                    <input type="hidden" id="incidentId">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="incidentFicha">N√∫mero de Ficha</label>
                            <input type="text" id="incidentFicha" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="incidentVehicle">Veh√≠culo</label>
                            <select id="incidentVehicle" class="form-control" required>
                                <option value="">Seleccionar veh√≠culo</option>
                                <!-- Options will be populated by JavaScript -->
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="incidentDate">Fecha y Hora</label>
                            <input type="datetime-local" id="incidentDate" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="incidentType">Tipo de Incidente</label>
                            <select id="incidentType" class="form-control" required>
                                <option value="">Seleccionar tipo</option>
                                <option value="collision">Colisi√≥n</option>
                                <option value="mechanical_failure">Falla Mec√°nica</option>
                                <option value="theft">Robo</option>
                                <option value="vandalism">Vandalismo</option>
                                <option value="accident">Accidente</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="incidentSeverity">Gravedad</label>
                            <select id="incidentSeverity" class="form-control" required>
                                <option value="low">Baja</option>
                                <option value="medium">Media</option>
                                <option value="high">Alta</option>
                                <option value="critical">Cr√≠tica</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="incidentCost">Costo Estimado ($)</label>
                            <input type="number" id="incidentCost" class="form-control" step="0.01" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="incidentDescription">Descripci√≥n</label>
                        <textarea id="incidentDescription" class="form-control" rows="3" required></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="incidentDriver">Conductor</label>
                            <input type="text" id="incidentDriver" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-footer">
                        <button type="button" class="btn btn-outline" id="cancelIncidentBtn">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Registrar Incidente</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script>
        // Datos simulados para la aplicaci√≥n
        let vehicles = [
            { id: 1, ficha: 'FV-001', plate: 'ABC-123', brand: 'Volvo', model: 'FH16', year: 2020, mileage: 125430, status: 'available', lastMaintenance: '15/05/2024', nextOilChange: '15/08/2024' },
            { id: 2, ficha: 'FV-002', plate: 'DEF-456', brand: 'Scania', model: 'S730', year: 2019, mileage: 98760, status: 'in_transit', lastMaintenance: '22/04/2024', nextOilChange: '22/07/2024' },
            { id: 3, ficha: 'FV-003', plate: 'GHI-789', brand: 'Mercedes-Benz', model: 'Atego', year: 2021, mileage: 76320, status: 'maintenance', lastMaintenance: '30/05/2024', nextOilChange: '30/08/2024' },
            { id: 4, ficha: 'FV-004', plate: 'JKL-012', brand: 'Renault', model: 'Master', year: 2018, mileage: 156890, status: 'available', lastMaintenance: '10/06/2024', nextOilChange: '10/09/2024' }
        ];
        
        let maintenances = [
            { id: 1, ficha: 'FM-001', vehicleId: 1, type: 'preventive', description: 'Cambio de aceite y filtro', scheduledDate: '15/06/2024', cost: 120.00, status: 'scheduled' },
            { id: 2, ficha: 'FM-002', vehicleId: 2, type: 'corrective', description: 'Reparaci√≥n de frenos', scheduledDate: '18/06/2024', cost: 450.00, status: 'in_progress' },
            { id: 3, ficha: 'FM-003', vehicleId: 3, type: 'preventive', description: 'Rotaci√≥n de neum√°ticos', scheduledDate: '20/06/2024', cost: 80.00, status: 'completed' },
            { id: 4, ficha: 'FM-004', vehicleId: 4, type: 'preventive', description: 'Revisi√≥n general', scheduledDate: '22/06/2024', cost: 150.00, status: 'scheduled' }
        ];
        
        let incidents = [
            { id: 1, ficha: 'FI-001', vehicleId: 2, date: '10/06/2024 14:30', type: 'collision', severity: 'medium', description: 'Colisi√≥n menor en la parte trasera', driver: 'Mar√≠a Garc√≠a', cost: 320.00 },
            { id: 2, ficha: 'FI-002', vehicleId: 1, date: '05/06/2024 09:15', type: 'mechanical_failure', severity: 'high', description: 'Falla en el sistema de frenos', driver: 'Carlos L√≥pez', cost: 850.00 },
            { id: 3, ficha: 'FI-003', vehicleId: 3, date: '01/06/2024 16:45', type: 'accident', severity: 'low', description: 'Ray√≥n en la puerta lateral', driver: 'Juan P√©rez', cost: 120.00 }
        ];
        
        let trackingData = [
            { id: 1, ficha: 'FT-001', vehicleId: 1, timestamp: '15/06/2024 08:30', mileage: 125430, location: 'Av. Principal 123', speed: 65, status: 'in_transit' },
            { id: 2, ficha: 'FT-002', vehicleId: 2, timestamp: '15/06/2024 09:15', mileage: 98760, location: 'Calle Secundaria 456', speed: 58, status: 'in_transit' },
            { id: 3, ficha: 'FT-003', vehicleId: 3, timestamp: '15/06/2024 10:00', mileage: 76320, location: 'Taller Central', speed: 0, status: 'maintenance' }
        ];
        
        let notifications = [
            { id: 1, type: 'maintenance', title: 'Mantenimiento pr√≥ximo', message: 'Veh√≠culo XYZ-789 necesita mantenimiento en 3 d√≠as', time: 'Hace 1 hora', unread: true },
            { id: 2, type: 'vehicles', title: 'Veh√≠culo disponible', message: 'Veh√≠culo DEF-456 est√° disponible para asignaci√≥n', time: 'Hace 3 horas', unread: true },
            { id: 3, type: 'maintenance', title: 'Cambio de pieza programado', message: 'Reemplazo de frenos en veh√≠culo ABC-123', time: 'Hace 1 d√≠a', unread: true },
            { id: 4, type: 'incident', title: 'Nuevo incidente reportado', message: 'Colisi√≥n reportada para veh√≠culo DEF-456', time: 'Hace 2 horas', unread: true },
            { id: 5, type: 'tracking', title: 'Desviaci√≥n de ruta', message: 'Veh√≠culo GHI-789 se ha desviado de su ruta programada', time: 'Hace 45 minutos', unread: true }
        ];
        
        // Variables globales
        let currentVehicleId = null;
        let currentMaintenanceId = null;
        let currentIncidentId = null;
        
        // Inicializaci√≥n de la aplicaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            // Cargar datos iniciales
            loadVehicles();
            loadMaintenances();
            loadIncidents();
            loadTrackingData();
            loadNotifications();
            initializeCharts();
            
            // Configurar navegaci√≥n
            setupNavigation();
            
            // Configurar formularios
            setupForms();
            
            // Configurar modales
            setupModals();
            
            // Configurar notificaciones
            setupNotifications();
            
            // Configurar reportes
            setupReports();
            
            // Configurar mapa
            setupMap();
        });
        
        // Navegaci√≥n
        function setupNavigation() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remove active class from all items
                    document.querySelectorAll('.nav-item').forEach(nav => {
                        nav.classList.remove('active');
                    });
                    
                    // Add active class to clicked item
                    this.classList.add('active');
                    
                    // Hide all pages
                    document.querySelectorAll('.page').forEach(page => {
                        page.style.display = 'none';
                    });
                    
                    // Show selected page
                    const page = this.getAttribute('data-page');
                    document.getElementById(`${page}-page`).style.display = 'block';
                    
                    // Update header title
                    const titles = {
                        dashboard: 'Dashboard',
                        vehicles: 'Veh√≠culos',
                        maintenance: 'Mantenimiento',
                        incidents: 'Incidentes',
                        tracking: 'Seguimiento GPS',
                        reports: 'Reportes y Estad√≠sticas'
                    };
                    
                    document.querySelector('.header-title h1').textContent = titles[page];
                    document.querySelector('.header-title p').textContent = getPageDescription(page);
                });
            });
        }
        
        function getPageDescription(page) {
            const descriptions = {
                dashboard: 'Resumen de tu flota de veh√≠culos',
                vehicles: 'Gestiona tu flota de veh√≠culos',
                maintenance: 'Gestiona el mantenimiento de tu flota',
                incidents: 'Registro de incidentes y da√±os',
                tracking: 'Ubicaci√≥n en tiempo real de tu flota',
                reports: 'An√°lisis detallado de tu flota'
            };
            return descriptions[page];
        }
        
        // Carga de datos
        function loadVehicles() {
            const tableBody = document.getElementById('vehiclesTable');
            tableBody.innerHTML = '';
            
            vehicles.forEach(vehicle => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${vehicle.ficha}</td>
                    <td>${vehicle.plate}</td>
                    <td>${vehicle.brand} ${vehicle.model}</td>
                    <td>${vehicle.year}</td>
                    <td>${vehicle.mileage.toLocaleString()} km</td>
                    <td>${vehicle.lastMaintenance}</td>
                    <td>${vehicle.nextOilChange} (${(135000 - vehicle.mileage).toLocaleString()} km)</td>
                    <td>
                        <button class="action-btn edit-vehicle" data-id="${vehicle.id}"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete-vehicle" data-id="${vehicle.id}"><i class="fas fa-trash"></i></button>
                        <button class="action-btn view-history" data-id="${vehicle.id}"><i class="fas fa-history"></i></button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Agregar event listeners
            document.querySelectorAll('.edit-vehicle').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    editVehicle(id);
                });
            });
            
            document.querySelectorAll('.delete-vehicle').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    deleteVehicle(id);
                });
            });
            
            // Actualizar estad√≠sticas
            document.getElementById('totalVehicles').textContent = vehicles.length;
        }
        
        function loadMaintenances() {
            const tableBody = document.getElementById('maintenanceTable');
            const scheduledTableBody = document.getElementById('scheduledMaintenanceTable');
            tableBody.innerHTML = '';
            scheduledTableBody.innerHTML = '';
            
            maintenances.forEach(maintenance => {
                const vehicle = vehicles.find(v => v.id === maintenance.vehicleId);
                const vehicleName = vehicle ? `${vehicle.plate} - ${vehicle.brand} ${vehicle.model}` : 'Desconocido';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${maintenance.ficha}</td>
                    <td>MT-2024-${maintenance.id.toString().padStart(3, '0')}</td>
                    <td>${vehicleName}</td>
                    <td>${maintenance.type === 'preventive' ? 'Preventivo' : maintenance.type === 'corrective' ? 'Correctivo' : 'Predictivo'}</td>
                    <td>${maintenance.description}</td>
                    <td>${maintenance.scheduledDate}</td>
                    <td>$${maintenance.cost.toFixed(2)}</td>
                    <td><span class="status-badge ${maintenance.status}">${getStatusText(maintenance.status)}</span></td>
                    <td>
                        <button class="action-btn edit-maintenance" data-id="${maintenance.id}"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete-maintenance" data-id="${maintenance.id}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tableBody.appendChild(row);
                
                // Si est√° programado, tambi√©n mostrar en el dashboard
                if (maintenance.status === 'scheduled') {
                    const scheduledRow = document.createElement('tr');
                    scheduledRow.innerHTML = `
                        <td>${maintenance.ficha}</td>
                        <td>${vehicleName}</td>
                        <td>${maintenance.type === 'preventive' ? 'Preventivo' : maintenance.type === 'corrective' ? 'Correctivo' : 'Predictivo'}</td>
                        <td>${maintenance.description}</td>
                        <td>${maintenance.scheduledDate}</td>
                        <td><span class="status-badge ${maintenance.status}">${getStatusText(maintenance.status)}</span></td>
                        <td>
                            <button class="action-btn view-maintenance" data-id="${maintenance.id}"><i class="fas fa-eye"></i></button>
                        </td>
                    `;
                    scheduledTableBody.appendChild(scheduledRow);
                }
            });
            
            // Agregar event listeners
            document.querySelectorAll('.edit-maintenance').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    editMaintenance(id);
                });
            });
            
            document.querySelectorAll('.delete-maintenance').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    deleteMaintenance(id);
                });
            });
            
            // Actualizar estad√≠sticas
            document.getElementById('activeMaintenance').textContent = maintenances.filter(m => m.status !== 'completed').length;
        }
        
        function loadIncidents() {
            const tableBody = document.getElementById('incidentsTable');
            tableBody.innerHTML = '';
            
            incidents.forEach(incident => {
                const vehicle = vehicles.find(v => v.id === incident.vehicleId);
                const vehicleName = vehicle ? `${vehicle.plate} - ${vehicle.brand} ${vehicle.model}` : 'Desconocido';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${incident.ficha}</td>
                    <td>INC-2024-${incident.id.toString().padStart(3, '0')}</td>
                    <td>${vehicleName}</td>
                    <td>${incident.date}</td>
                    <td>${getIncidentTypeText(incident.type)}</td>
                    <td>${incident.driver}</td>
                    <td><span class="status-badge ${incident.severity}">${getSeverityText(incident.severity)}</span></td>
                    <td>$${incident.cost.toFixed(2)}</td>
                    <td>
                        <button class="action-btn edit-incident" data-id="${incident.id}"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete-incident" data-id="${incident.id}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Agregar event listeners
            document.querySelectorAll('.edit-incident').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    editIncident(id);
                });
            });
            
            document.querySelectorAll('.delete-incident').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    deleteIncident(id);
                });
            });
        }
        
        function loadTrackingData() {
            const tableBody = document.getElementById('trackingHistoryTable');
            tableBody.innerHTML = '';
            
            // Mostrar los √∫ltimos 5 registros
            const recentTracking = trackingData.slice(-5).reverse();
            
            recentTracking.forEach(track => {
                const vehicle = vehicles.find(v => v.id === track.vehicleId);
                const vehicleName = vehicle ? `${vehicle.plate} - ${vehicle.brand} ${vehicle.model}` : 'Desconocido';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${track.ficha}</td>
                    <td>${vehicleName}</td>
                    <td>${track.timestamp}</td>
                    <td>${track.mileage.toLocaleString()} km</td>
                    <td>${track.location}</td>
                    <td>${track.speed} km/h</td>
                    <td><span class="status-badge ${track.status}">${getStatusText(track.status)}</span></td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function loadNotifications() {
            const notificationList = document.getElementById('notificationList');
            const notificationBadge = document.getElementById('notificationBadge');
            notificationList.innerHTML = '';
            
            const unreadCount = notifications.filter(n => n.unread).length;
            notificationBadge.textContent = unreadCount;
            notificationBadge.style.display = unreadCount > 0 ? 'flex' : 'none';
            
            notifications.forEach(notification => {
                const item = document.createElement('div');
                item.className = `notification-item ${notification.unread ? 'unread' : ''}`;
                item.innerHTML = `
                    <div class="notification-icon ${notification.type}">
                        <i class="fas ${getNotificationIcon(notification.type)}"></i>
                    </div>
                    <div class="notification-content">
                        <h5>${notification.title}</h5>
                        <p>${notification.message}</p>
                        <div class="notification-time">${notification.time}</div>
                    </div>
                `;
                notificationList.appendChild(item);
            });
        }
        
        // Funciones auxiliares
        function getStatusText(status) {
            const statusMap = {
                'scheduled': 'Programado',
                'in_progress': 'En Progreso',
                'completed': 'Completado',
                'available': 'Disponible',
                'in_transit': 'En Tr√°nsito',
                'maintenance': 'Mantenimiento',
                'out_of_service': 'Fuera de Servicio'
            };
            return statusMap[status] || status;
        }
        
        function getSeverityText(severity) {
            const severityMap = {
                'low': 'Baja',
                'medium': 'Media',
                'high': 'Alta',
                'critical': 'Cr√≠tica'
            };
            return severityMap[severity] || severity;
        }
        
        function getIncidentTypeText(type) {
            const typeMap = {
                'collision': 'Colisi√≥n',
                'mechanical_failure': 'Falla Mec√°nica',
                'theft': 'Robo',
                'vandalism': 'Vandalismo',
                'accident': 'Accidente'
            };
            return typeMap[type] || type;
        }
        
        function getNotificationIcon(type) {
            const iconMap = {
                'maintenance': 'fa-tools',
                'vehicles': 'fa-truck',
                'incident': 'fa-car-crash',
                'tracking': 'fa-map-marked-alt'
            };
            return iconMap[type] || 'fa-bell';
        }
        
        // Formularios
        function setupForms() {
            // Formulario de veh√≠culos
            document.getElementById('vehicleForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveVehicle();
            });
            
            // Formulario de mantenimiento
            document.getElementById('maintenanceForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveMaintenance();
            });
            
            // Formulario de incidentes
            document.getElementById('incidentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveIncident();
            });
            
            // Botones de cancelar
            document.getElementById('cancelVehicleBtn').addEventListener('click', function() {
                closeVehicleModal();
            });
            
            document.getElementById('cancelMaintenanceBtn').addEventListener('click', function() {
                closeMaintenanceModal();
            });
            
            document.getElementById('cancelIncidentBtn').addEventListener('click', function() {
                closeIncidentModal();
            });
            
            // Botones de agregar
            document.getElementById('addVehicleBtn').addEventListener('click', function() {
                openVehicleModal();
            });
            
            document.getElementById('addMaintenanceBtn').addEventListener('click', function() {
                populateVehicleSelect('maintenanceVehicle');
                openMaintenanceModal();
            });
            
            document.getElementById('addIncidentBtn').addEventListener('click', function() {
                populateVehicleSelect('incidentVehicle');
                openIncidentModal();
            });
        }
        
        function populateVehicleSelect(selectId) {
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">Seleccionar veh√≠culo</option>';
            
            vehicles.forEach(vehicle => {
                const option = document.createElement('option');
                option.value = vehicle.id;
                option.textContent = `${vehicle.ficha} - ${vehicle.plate} - ${vehicle.brand} ${vehicle.model}`;
                select.appendChild(option);
            });
        }
        
        // Modales
        function setupModals() {
            // Cerrar modales al hacer clic fuera
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('show');
                    }
                });
            });
        }
        
        function openVehicleModal() {
            document.getElementById('vehicleModalTitle').textContent = 'Agregar Veh√≠culo';
            document.getElementById('vehicleForm').reset();
            document.getElementById('vehicleId').value = '';
            document.getElementById('vehicleFicha').value = generateFicha('FV');
            document.getElementById('vehicleModal').classList.add('show');
        }
        
        function closeVehicleModal() {
            document.getElementById('vehicleModal').classList.remove('show');
        }
        
        function openMaintenanceModal() {
            document.getElementById('maintenanceModalTitle').textContent = 'Nueva Orden de Mantenimiento';
            document.getElementById('maintenanceForm').reset();
            document.getElementById('maintenanceId').value = '';
            document.getElementById('maintenanceFicha').value = generateFicha('FM');
            populateVehicleSelect('maintenanceVehicle');
            document.getElementById('maintenanceModal').classList.add('show');
        }
        
        function closeMaintenanceModal() {
            document.getElementById('maintenanceModal').classList.remove('show');
        }
        
        function openIncidentModal() {
            document.getElementById('incidentModalTitle').textContent = 'Registrar Incidente';
            document.getElementById('incidentForm').reset();
            document.getElementById('incidentId').value = '';
            document.getElementById('incidentFicha').value = generateFicha('FI');
            populateVehicleSelect('incidentVehicle');
            document.getElementById('incidentModal').classList.add('show');
        }
        
        function closeIncidentModal() {
            document.getElementById('incidentModal').classList.remove('show');
        }
        
        function generateFicha(prefix) {
            // Generar un n√∫mero de ficha √∫nico
            const date = new Date();
            const year = date.getFullYear().toString().substr(-2);
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            return `${prefix}-${year}${month}${day}-${random}`;
        }
        
        function editVehicle(id) {
            const vehicle = vehicles.find(v => v.id === id);
            if (!vehicle) return;
            
            document.getElementById('vehicleModalTitle').textContent = 'Editar Veh√≠culo';
            document.getElementById('vehicleId').value = vehicle.id;
            document.getElementById('vehicleFicha').value = vehicle.ficha;
            document.getElementById('plate').value = vehicle.plate;
            document.getElementById('brand').value = vehicle.brand;
            document.getElementById('model').value = vehicle.model;
            document.getElementById('year').value = vehicle.year;
            document.getElementById('mileage').value = vehicle.mileage;
            document.getElementById('status').value = vehicle.status;
            
            document.getElementById('vehicleModal').classList.add('show');
        }
        
        function editMaintenance(id) {
            const maintenance = maintenances.find(m => m.id === id);
            if (!maintenance) return;
            
            populateVehicleSelect('maintenanceVehicle');
            
            document.getElementById('maintenanceModalTitle').textContent = 'Editar Orden de Mantenimiento';
            document.getElementById('maintenanceId').value = maintenance.id;
            document.getElementById('maintenanceFicha').value = maintenance.ficha;
            document.getElementById('maintenanceVehicle').value = maintenance.vehicleId;
            document.getElementById('maintenanceType').value = maintenance.type;
            document.getElementById('maintenanceDescription').value = maintenance.description;
            document.getElementById('scheduledDate').value = maintenance.scheduledDate.split('/').reverse().join('-');
            document.getElementById('maintenanceCost').value = maintenance.cost;
            
            document.getElementById('maintenanceModal').classList.add('show');
        }
        
        function editIncident(id) {
            const incident = incidents.find(i => i.id === id);
            if (!incident) return;
            
            populateVehicleSelect('incidentVehicle');
            
            document.getElementById('incidentModalTitle').textContent = 'Editar Incidente';
            document.getElementById('incidentId').value = incident.id;
            document.getElementById('incidentFicha').value = incident.ficha;
            document.getElementById('incidentVehicle').value = incident.vehicleId;
            document.getElementById('incidentDate').value = incident.date.replace(' ', 'T');
            document.getElementById('incidentType').value = incident.type;
            document.getElementById('incidentSeverity').value = incident.severity;
            document.getElementById('incidentDescription').value = incident.description;
            document.getElementById('incidentDriver').value = incident.driver;
            document.getElementById('incidentCost').value = incident.cost;
            
            document.getElementById('incidentModal').classList.add('show');
        }
        
        function saveVehicle() {
            const id = document.getElementById('vehicleId').value;
            const ficha = document.getElementById('vehicleFicha').value;
            const plate = document.getElementById('plate').value;
            const brand = document.getElementById('brand').value;
            const model = document.getElementById('model').value;
            const year = parseInt(document.getElementById('year').value);
            const mileage = parseInt(document.getElementById('mileage').value);
            const status = document.getElementById('status').value;
            
            if (id) {
                // Editar veh√≠culo existente
                const vehicle = vehicles.find(v => v.id === parseInt(id));
                if (vehicle) {
                    vehicle.ficha = ficha;
                    vehicle.plate = plate;
                    vehicle.brand = brand;
                    vehicle.model = model;
                    vehicle.year = year;
                    vehicle.mileage = mileage;
                    vehicle.status = status;
                }
            } else {
                // Agregar nuevo veh√≠culo
                const newId = vehicles.length > 0 ? Math.max(...vehicles.map(v => v.id)) + 1 : 1;
                vehicles.push({
                    id: newId,
                    ficha,
                    plate,
                    brand,
                    model,
                    year,
                    mileage,
                    status,
                    lastMaintenance: 'N/A',
                    nextOilChange: 'N/A'
                });
            }
            
            loadVehicles();
            closeVehicleModal();
        }
        
        function saveMaintenance() {
            const id = document.getElementById('maintenanceId').value;
            const ficha = document.getElementById('maintenanceFicha').value;
            const vehicleId = parseInt(document.getElementById('maintenanceVehicle').value);
            const type = document.getElementById('maintenanceType').value;
            const description = document.getElementById('maintenanceDescription').value;
            const scheduledDate = document.getElementById('scheduledDate').value.split('-').reverse().join('/');
            const cost = parseFloat(document.getElementById('maintenanceCost').value);
            
            if (id) {
                // Editar mantenimiento existente
                const maintenance = maintenances.find(m => m.id === parseInt(id));
                if (maintenance) {
                    maintenance.ficha = ficha;
                    maintenance.vehicleId = vehicleId;
                    maintenance.type = type;
                    maintenance.description = description;
                    maintenance.scheduledDate = scheduledDate;
                    maintenance.cost = cost;
                }
            } else {
                // Agregar nuevo mantenimiento
                const newId = maintenances.length > 0 ? Math.max(...maintenances.map(m => m.id)) + 1 : 1;
                maintenances.push({
                    id: newId,
                    ficha,
                    vehicleId,
                    type,
                    description,
                    scheduledDate,
                    cost,
                    status: 'scheduled'
                });
            }
            
            loadMaintenances();
            closeMaintenanceModal();
        }
        
        function saveIncident() {
            const id = document.getElementById('incidentId').value;
            const ficha = document.getElementById('incidentFicha').value;
            const vehicleId = parseInt(document.getElementById('incidentVehicle').value);
            const date = document.getElementById('incidentDate').value.replace('T', ' ');
            const type = document.getElementById('incidentType').value;
            const severity = document.getElementById('incidentSeverity').value;
            const description = document.getElementById('incidentDescription').value;
            const driver = document.getElementById('incidentDriver').value;
            const cost = parseFloat(document.getElementById('incidentCost').value);
            
            if (id) {
                // Editar incidente existente
                const incident = incidents.find(i => i.id === parseInt(id));
                if (incident) {
                    incident.ficha = ficha;
                    incident.vehicleId = vehicleId;
                    incident.date = date;
                    incident.type = type;
                    incident.severity = severity;
                    incident.description = description;
                    incident.driver = driver;
                    incident.cost = cost;
                }
            } else {
                // Agregar nuevo incidente
                const newId = incidents.length > 0 ? Math.max(...incidents.map(i => i.id)) + 1 : 1;
                incidents.push({
                    id: newId,
                    ficha,
                    vehicleId,
                    date,
                    type,
                    severity,
                    description,
                    driver,
                    cost
                });
            }
            
            loadIncidents();
            closeIncidentModal();
        }
        
        function deleteVehicle(id) {
            if (confirm('¬øEst√°s seguro de que deseas eliminar este veh√≠culo?')) {
                vehicles = vehicles.filter(v => v.id !== id);
                loadVehicles();
                loadMaintenances();
                loadIncidents();
                loadTrackingData();
            }
        }
        
        function deleteMaintenance(id) {
            if (confirm('¬øEst√°s seguro de que deseas eliminar esta orden de mantenimiento?')) {
                maintenances = maintenances.filter(m => m.id !== id);
                loadMaintenances();
            }
        }
        
        function deleteIncident(id) {
            if (confirm('¬øEst√°s seguro de que deseas eliminar este incidente?')) {
                incidents = incidents.filter(i => i.id !== id);
                loadIncidents();
            }
        }
        
        // Notificaciones
        function setupNotifications() {
            const notificationBtn = document.getElementById('notificationBtn');
            const notificationDropdown = document.getElementById('notificationDropdown');
            const markAllRead = document.getElementById('markAllRead');
            
            notificationBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                notificationDropdown.classList.toggle('show');
            });
            
            markAllRead.addEventListener('click', function(e) {
                e.preventDefault();
                notifications.forEach(notification => {
                    notification.unread = false;
                });
                loadNotifications();
            });
            
            document.addEventListener('click', function(e) {
                if (!notificationBtn.contains(e.target) && !notificationDropdown.contains(e.target)) {
                    notificationDropdown.classList.remove('show');
                }
            });
        }
        
        // Reportes
        function setupReports() {
            // Tabs de reportes
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remover clase activa de todos los tabs
                    document.querySelectorAll('.tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    
                    // Agregar clase activa al tab seleccionado
                    this.classList.add('active');
                    
                    // Mostrar contenido del tab seleccionado
                    const tabName = this.getAttribute('data-tab');
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.style.display = 'none';
                    });
                    document.getElementById(`${tabName}Reports`).style.display = 'block';
                });
            });
            
            // Botones de exportar PDF
            document.getElementById('exportReport').addEventListener('click', function() {
                exportMaintenanceReport();
            });
            
            document.getElementById('exportIncidentReport').addEventListener('click', function() {
                exportIncidentReport();
            });
            
            document.getElementById('exportTrackingReport').addEventListener('click', function() {
                exportTrackingReport();
            });
            
            document.getElementById('exportVehiclesReport').addEventListener('click', function() {
                exportVehiclesReport();
            });
            
            // Generar reportes
            document.getElementById('generateReport').addEventListener('click', function() {
                generateMaintenanceReport();
            });
            
            document.getElementById('generateIncidentReport').addEventListener('click', function() {
                generateIncidentReport();
            });
            
            document.getElementById('generateTrackingReport').addEventListener('click', function() {
                generateTrackingReport();
            });
            
            document.getElementById('generateVehiclesReport').addEventListener('click', function() {
                generateVehiclesReport();
            });
            
            // Cargar reportes iniciales
            generateMaintenanceReport();
            generateIncidentReport();
            generateTrackingReport();
            generateVehiclesReport();
        }
        
        function generateMaintenanceReport() {
            const reportTable = document.getElementById('maintenanceReportTable');
            reportTable.innerHTML = '';
            
            vehicles.forEach(vehicle => {
                const vehicleMaintenances = maintenances.filter(m => m.vehicleId === vehicle.id);
                const totalCost = vehicleMaintenances.reduce((sum, m) => sum + m.cost, 0);
                const partsUsed = vehicleMaintenances.length * 3; // Simulaci√≥n
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${vehicle.ficha}</td>
                    <td>${vehicle.plate} - ${vehicle.brand} ${vehicle.model}</td>
                    <td>${vehicleMaintenances.length}</td>
                    <td>$${totalCost.toFixed(2)}</td>
                    <td>${partsUsed}</td>
                    <td>${(vehicle.mileage / 12).toFixed(0)} km/mes</td>
                    <td>${(95 - (vehicleMaintenances.length * 2)).toFixed(0)}%</td>
                `;
                reportTable.appendChild(row);
            });
        }
        
        function generateIncidentReport() {
            const reportTable = document.getElementById('incidentReportTable');
            reportTable.innerHTML = '';
            
            vehicles.forEach(vehicle => {
                const vehicleIncidents = incidents.filter(i => i.vehicleId === vehicle.id);
                const totalCost = vehicleIncidents.reduce((sum, i) => sum + i.cost, 0);
                const drivers = [...new Set(vehicleIncidents.map(i => i.driver))];
                const commonType = vehicleIncidents.length > 0 ? 
                    [...new Set(vehicleIncidents.map(i => i.type))][0] : 'N/A';
                const avgSeverity = vehicleIncidents.length > 0 ? 
                    (vehicleIncidents.reduce((sum, i) => sum + (i.severity === 'low' ? 1 : i.severity === 'medium' ? 2 : i.severity === 'high' ? 3 : 4), 0) / vehicleIncidents.length).toFixed(1) : 'N/A';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${vehicle.ficha}</td>
                    <td>${vehicle.plate} - ${vehicle.brand} ${vehicle.model}</td>
                    <td>${vehicleIncidents.length}</td>
                    <td>$${totalCost.toFixed(2)}</td>
                    <td>${drivers.length}</td>
                    <td>${getIncidentTypeText(commonType)}</td>
                    <td>${avgSeverity}</td>
                `;
                reportTable.appendChild(row);
            });
        }
        
        function generateTrackingReport() {
            const reportTable = document.getElementById('trackingReportTable');
            reportTable.innerHTML = '';
            
            vehicles.forEach(vehicle => {
                const vehicleTracking = trackingData.filter(t => t.vehicleId === vehicle.id);
                const totalMileage = vehicleTracking.reduce((sum, t) => sum + t.mileage, 0);
                const totalTime = vehicleTracking.length * 2; // Simulaci√≥n
                const avgSpeed = vehicleTracking.length > 0 ? 
                    (vehicleTracking.reduce((sum, t) => sum + t.speed, 0) / vehicleTracking.length).toFixed(1) : 0;
                const locations = [...new Set(vehicleTracking.map(t => t.location))].join(', ');
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${vehicle.ficha}</td>
                    <td>${vehicle.plate} - ${vehicle.brand} ${vehicle.model}</td>
                    <td>${totalMileage.toLocaleString()} km</td>
                    <td>${totalTime} horas</td>
                    <td>${avgSpeed} km/h</td>
                    <td>${locations.substring(0, 30)}${locations.length > 30 ? '...' : ''}</td>
                `;
                reportTable.appendChild(row);
            });
        }
        
        function generateVehiclesReport() {
            const reportTable = document.getElementById('vehiclesReportTable');
            reportTable.innerHTML = '';
            
            vehicles.forEach(vehicle => {
                const vehicleMaintenances = maintenances.filter(m => m.vehicleId === vehicle.id);
                const vehicleIncidents = incidents.filter(i => i.vehicleId === vehicle.id);
                const totalCost = vehicleMaintenances.reduce((sum, m) => sum + m.cost, 0) + 
                                 vehicleIncidents.reduce((sum, i) => sum + i.cost, 0);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${vehicle.ficha}</td>
                    <td>${vehicle.plate} - ${vehicle.brand} ${vehicle.model}</td>
                    <td><span class="status-badge ${vehicle.status}">${getStatusText(vehicle.status)}</span></td>
                    <td>${vehicle.mileage.toLocaleString()} km</td>
                    <td>${vehicleMaintenances.length}</td>
                    <td>${vehicleIncidents.length}</td>
                    <td>$${totalCost.toFixed(2)}</td>
                `;
                reportTable.appendChild(row);
            });
        }
        
        function exportMaintenanceReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // T√≠tulo
            doc.setFontSize(18);
            doc.text('Reporte de Mantenimiento - FleetFlow', 14, 20);
            
            // Fecha
            doc.setFontSize(12);
            doc.text(`Fecha: ${new Date().toLocaleDateString()}`, 14, 30);
            
            // Tabla
            doc.autoTable({
                startY: 40,
                head: [['Ficha', 'Veh√≠culo', 'Mantenimientos', 'Costo Total', 'Piezas', 'Km Promedio', 'Eficiencia']],
                body: Array.from(document.getElementById('maintenanceReportTable').rows).map(row => {
                    return Array.from(row.cells).map(cell => cell.textContent);
                }),
                theme: 'grid'
            });
            
            // Guardar PDF
            doc.save('reporte_mantenimiento.pdf');
        }
        
        function exportIncidentReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // T√≠tulo
            doc.setFontSize(18);
            doc.text('Reporte de Incidentes - FleetFlow', 14, 20);
            
            // Fecha
            doc.setFontSize(12);
            doc.text(`Fecha: ${new Date().toLocaleDateString()}`, 14, 30);
            
            // Tabla
            doc.autoTable({
                startY: 40,
                head: [['Ficha', 'Veh√≠culo', 'Incidentes', 'Costo Total', 'Conductores', 'Tipo Com√∫n', 'Gravedad']],
                body: Array.from(document.getElementById('incidentReportTable').rows).map(row => {
                    return Array.from(row.cells).map(cell => cell.textContent);
                }),
                theme: 'grid'
            });
            
            // Guardar PDF
            doc.save('reporte_incidentes.pdf');
        }
        
        function exportTrackingReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // T√≠tulo
            doc.setFontSize(18);
            doc.text('Reporte de Seguimiento - FleetFlow', 14, 20);
            
            // Fecha
            doc.setFontSize(12);
            doc.text(`Fecha: ${new Date().toLocaleDateString()}`, 14, 30);
            
            // Tabla
            doc.autoTable({
                startY: 40,
                head: [['Ficha', 'Veh√≠culo', 'Kilometraje Total', 'Tiempo en Ruta', 'Velocidad Promedio', 'Ubicaciones']],
                body: Array.from(document.getElementById('trackingReportTable').rows).map(row => {
                    return Array.from(row.cells).map(cell => cell.textContent);
                }),
                theme: 'grid'
            });
            
            // Guardar PDF
            doc.save('reporte_seguimiento.pdf');
        }
        
        function exportVehiclesReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // T√≠tulo
            doc.setFontSize(18);
            doc.text('Reporte de Veh√≠culos - FleetFlow', 14, 20);
            
            // Fecha
            doc.setFontSize(12);
            doc.text(`Fecha: ${new Date().toLocaleDateString()}`, 14, 30);
            
            // Tabla
            doc.autoTable({
                startY: 40,
                head: [['Ficha', 'Veh√≠culo', 'Estado Actual', 'Kilometraje Total', 'Mantenimientos', 'Incidentes', 'Costo Total']],
                body: Array.from(document.getElementById('vehiclesReportTable').rows).map(row => {
                    return Array.from(row.cells).map(cell => cell.textContent);
                }),
                theme: 'grid'
            });
            
            // Guardar PDF
            doc.save('reporte_vehiculos.pdf');
        }
        
        // Mapa
        function setupMap() {
            const mapContainer = document.getElementById('mapContainer');
            if (!mapContainer) return;
            
            // Simular mapa con gradientes
            mapContainer.style.background = 'linear-gradient(135deg, #e0f2fe 0%, #dbeafe 100%)';
            
            // Agregar marcadores de veh√≠culos
            vehicles.forEach(vehicle => {
                const marker = document.createElement('div');
                marker.className = `vehicle-marker ${vehicle.status}`;
                marker.style.left = `${20 + Math.random() * 60}%`;
                marker.style.top = `${20 + Math.random() * 60}%`;
                marker.innerHTML = '<i class="fas fa-truck"></i>';
                marker.title = `${vehicle.ficha} - ${vehicle.plate} - ${vehicle.brand} ${vehicle.model}`;
                mapContainer.appendChild(marker);
            });
            
            // Actualizar lista de veh√≠culos
            const vehicleList = document.getElementById('vehicleList');
            vehicleList.innerHTML = '';
            
            vehicles.forEach(vehicle => {
                const item = document.createElement('div');
                item.className = 'vehicle-item';
                item.innerHTML = `
                    <div class="vehicle-marker ${vehicle.status}"></div>
                    <div class="vehicle-info">
                        <strong>${vehicle.ficha} - ${vehicle.plate}</strong> - ${vehicle.driver || 'Sin conductor'}
                        <div class="vehicle-details">Vel: ${Math.floor(Math.random() * 80) + 20} km/h</div>
                    </div>
                `;
                vehicleList.appendChild(item);
            });
        }
        
        // Gr√°ficos
        function initializeCharts() {
            // Gr√°fico de mantenimientos
            const maintenanceCtx = document.getElementById('maintenanceChart').getContext('2d');
            new Chart(maintenanceCtx, {
                type: 'bar',
                data: {
                    labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Mantenimientos Programados',
                        data: [12, 19, 15, 17, 22, 18],
                        backgroundColor: 'rgba(37, 99, 235, 0.7)',
                        borderColor: 'rgba(37, 99, 235, 1)',
                        borderWidth: 1
                    }, {
                        label: 'Mantenimientos Completados',
                        data: [10, 17, 14, 15, 20, 16],
                        backgroundColor: 'rgba(16, 185, 129, 0.7)',
                        borderColor: 'rgba(16, 185, 129, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Gr√°fico de costos
            const costsCtx = document.getElementById('costsChart').getContext('2d');
            new Chart(costsCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Aceite y Filtros', 'Frenos', 'Neum√°ticos', 'Servicios Generales', 'Repuestos'],
                    datasets: [{
                        data: [12000, 8500, 6200, 4800, 3200],
                        backgroundColor: [
                            '#2563eb',
                            '#ef4444',
                            '#f59e0b',
                            '#8b5cf6',
                            '#10b981'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>